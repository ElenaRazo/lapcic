@{
    ViewBag.Title = "TipoPago";
    Layout = null;
}

    <form class="m-form m-form--fit m-form--label-align-right">
        <div class="m-portlet__body" style="height:inherit; padding:0">
            <table class="table table-striped m-table">
                @{ 
                    var estudio = "";
                    foreach (var c in ViewBag.Componentes)
                    {
                        @*if (estudio == "" || c.ClaveEstudio != estudio) {
                            <tr>
                                <td colspan="5">
                                    @c.ClaveEstudio
                                </td>
                            </tr>
                        }*@
                        <tr>
                            <td style="width:20%">
                                @c.Nombre
                                
                           </td>
                            <td style="width:25%">

                                @if (c.TipoCaptura.Id == 1) // numero
                                {
                                    <input fuera="0" idresultado="@(c.Resultado.IdResultado)" capturado="@(c.Resultado.Resultado != "" ? 1 : 0)"   captura="@c.TipoCaptura.Id" style="width:100%;text-align:center;" onfocusin="focusFunction(this)" onfocusout="blurFunction(this)" unidad="@c.Unidad" id="@("res" + c.Id.ToString())" type="text" negrita="0" titulo="2" class="res bres" max=" 
                                    @if (ViewBag.Edad <= 1)
                                    { @(c.MaxRN)}
                                    else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                    {  @(c.MaxN)  }
                                    else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                    {  @(c.MaxM) }
                                    else
                                    {@(c.MaxH)}" min="@if (ViewBag.Edad <= 1)
                                        { @(c.MinRN)  }
                                        else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                        {  @(c.MinN)  }
                                        else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                        {  @(c.MinM) }
                                        else
                                        {@(c.MinH)}" nombre="@c.Nombre" clave="@c.Id" claveEstudio="@c.ClaveEstudio" claveEstudioMain="@ViewBag.ClaveEstudio" value="@(c.Resultado != null ? c.Resultado.Resultado : "")" 
                                           
                                    textonormal="@{
                                        if (c.UsarValoresGenerales) { 
                                            if (ViewBag.Edad <= 1)
                                            { @(c.TextoNormalRecienNacido)}
                                            else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                            {  @(c.TextoNormalNiños)  }
                                            else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                            {  @(c.TextoNormalMujeres) }
                                            else
                                            {@(c.TextoNormalHombres)}
                                        }
                                            }"       


                                    />

                                }
                                else if (c.TipoCaptura.Id == 3) //personalizado
                                {
                                <textarea fuera="0" idresultado="@(c.Resultado.IdResultado)" captura="@c.TipoCaptura.Id" capturado="@(c.Resultado.Resultado != "" ? 1 : 0)" style="height:200px;width:100%" onfocusin="focusFunction(this)" onfocusout="blurFunction(this)" 
                                          unidad="@c.Unidad" id="@("res" + c.Id.ToString())" class="res" negrita="0" textonormal="@(Html.Raw(c.TextoNormalGeneral))" titulo="2" max="0" min="0" nombre="@c.Nombre" clave="@c.Id" claveEstudio="@c.ClaveEstudio" claveEstudioMain="@ViewBag.ClaveEstudio">@((c.Resultado != null  && c.Resultado.Resultado != null && c.Resultado.Resultado != "") ? c.Resultado.Resultado.Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n") : "")</textarea>
                                }
                                else if (c.TipoCaptura.Id == 2) //calculado
                                {
                                }
                                else if (c.TipoCaptura.Id == 4)
                                {
                                    <select onchange="changevalor(this)" idresultado="@(c.Resultado.IdResultado)" captura="@c.TipoCaptura.Id" capturado="@(c.Resultado.Resultado != "" ? 1 : 0)" fuera="0" unidad="@c.Unidad" max="0" min="0" textonormal="@if (ViewBag.Edad <= 1)
                                    { @(c.TextoNormalRecienNacido)}
                                    else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                    {  @(c.TextoNormalNiños)  }
                                    else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                    {  @(c.TextoNormalMujeres) }
                                    else
                                    {@(c.TextoNormalHombres)}" class="res bres" id="@("res" + c.Id.ToString())" nombre="@c.Nombre" clave="@c.Id" claveEstudio="@c.ClaveEstudio" claveEstudioMain="@ViewBag.ClaveEstudio" negrita="0" titulo="2">
                                        @foreach (var e in c.Elementos)
                                        {
                                            <option textto="@(c.Resultado != null ?  c.Resultado.Resultado : "res")" value="@e.Id" @(c.Resultado != null && c.Resultado.Resultado == e.Nombre ? "selected" : "") >@e.Nombre</option>
                                        }
                                    </select>
                                }
                                else {

                                }
                            </td>
                            <td style="width:10%" class="">
                                    @c.Unidad
                            </td>
                            <td style="width:20%" >
                                <label class="res@(c.Id.ToString()) normal">
                                    @if (c.TipoCaptura.Id == 1) // numero
                                    {
                                        if (c.UsarValoresGenerales)
                                        {
                                            if (ViewBag.Edad <= 1)
                                            {@(c.TextoNormalRecienNacido)}
                                            else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                            { @(c.TextoNormalNiños) }
                                            else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                            { @(c.TextoNormalMujeres) }
                                            else
                                            {@(c.TextoNormalHombres)}
                                        }
                                        else
                                        {
                                            if (ViewBag.Edad <= 1)
                                            {
                                            @(c.MinRN + " - " + c.MaxRN)
                                            }
                                            else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                            {
                                            @(c.MinN + " - " + c.MaxN)
                                            }
                                            else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                            {
                                            @(c.MinM + " - " + c.MaxM)
                                            }
                                            else
                                            {
                                            @(c.MinH + " - " + c.MaxH)
                                            }
                                        }
                                    }
                                    else// if (c.TipoCaptura.Id == 3) //personalizado
                                    {
                                        if (ViewBag.Edad <= 1)
                                        {
                                            @(c.TextoNormalRecienNacido == null || c.TextoNormalRecienNacido == "" ? Html.Raw(Html.Raw(c.TextoNormalGeneral)) : c.TextoNormalRecienNacido)
                                        }
                                        else if (ViewBag.Edad > 1 && ViewBag.Edad <= 12)
                                        {
                                            @(c.TextoNormalNiños == null || c.TextoNormalNiños == "" ? Html.Raw(c.TextoNormalGeneral) : c.TextoNormalNiños)
                                        }
                                        else if (ViewBag.Genero == "F" & ViewBag.Edad > 12)
                                        {
                                            @(c.TextoNormalMujeres == null || c.TextoNormalMujeres == "" ? Html.Raw(c.TextoNormalGeneral) : c.TextoNormalMujeres)
                                        }
                                        else if (ViewBag.Genero == "H" & ViewBag.Edad > 12)
                                        {
                                            @(c.TextoNormalHombres == null || c.TextoNormalHombres == "" ? Html.Raw(c.TextoNormalGeneral) : c.TextoNormalHombres)
                                        }
                                        else
                                        {
                                            @(Html.Raw(c.TextoNormalGeneral))
                                        }
                                    }
                                </label>
                            </td>
                            <td>
                                
                                <textarea id="@("2res" + c.Id.ToString())" type="text" placeholder="observacion" style="width:100%">@((c.Resultado != null  && c.Resultado.Observaciones != null && c.Resultado.Observaciones != "") ? c.Resultado.Observaciones.Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br/>", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n").Replace("<br />", "\n") : "")</textarea>
                            </td>
                    </tr>
                }
                }
        </table>
    </div>
    </form>
    <script>
        $(document).ready(function () {
            debugger;
        var elementos = $('.bres');
        for (var i = 0; i < elementos.length; i++) {
            var elemento = elementos[i];
            blurFunction(elemento);
        }
        if ("@ViewBag.Crear" == "True") {
            GuardarResultado(true);
        }
    });
    function changevalor(elm) {
        var resu = $('#' + elm.getAttribute('id'));
        var texto = elm.getAttribute("texto");
        //if (elm.getAttribute("captura") != "3") {
            if (texto != "") {
                if ($("#" + elm.getAttribute('id') + " :selected").text() == texto) {
                    elm.setAttribute("style", "background-color:green; color:white;");
                    elm.setAttribute("fuera", "0");
                }
                else {
                    elm.setAttribute("style", "background-color:red ;color:white;");
                    elm.setAttribute("fuera", "1");
                }
            }
       // }
    }

    function focusFunction(elm) {
        elm.style.background = "yellow";
        elm.style.color = "black";
    }
    function blurFunction(elm) {
        var id= elm.getAttribute('id');
        var resu = $('#' + elm.getAttribute('id'));
        var max = parseFloat(elm.getAttribute("max").replace(',', '.'));
        var min = parseFloat(elm.getAttribute("min").replace(',', '.'));

        if (parseFloat(resu.val().replace(',', '.')) < min || parseFloat(resu.val().replace(',', '.')) > max) {
            elm.setAttribute("style", "background-color:red; color:white;");
            elm.setAttribute("fuera", "1");
        }
        else if (parseFloat(resu.val()) >= min || parseFloat(resu.val()) <= max) {
            elm.setAttribute("style", "background-color:green ;color:white;");
            elm.setAttribute("fuera", "0");
        }
        else if (resu.options[resu.selectedIndex].text != $('#bres' + id)) {
            elm.setAttribute("style", "background-color:red; color:white;");
            elm.setAttribute("fuera", "0");
        }
        else {
            elm.setAttribute("style", "background-color:yellow ;color:black;");
            elm.setAttribute("fuera", "0");
        }
        if (resu[0].nodeName != "INPUT") {
            if (resu[0].options[resu[0].selectedIndex].text.trim() != $('.' + id).text().trim()) {
                elm.setAttribute("style", "background-color:red; color:white;");
                elm.setAttribute("fuera", "0");
            }
            else {
                elm.setAttribute("style", "background-color:green ;color:white;");
            elm.setAttribute("fuera", "0");
            }
        }
    }

    </script>